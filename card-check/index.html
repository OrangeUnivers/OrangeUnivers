<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phone Number Checker</title>
    <!-- <script src="https://cdn.jsdelivr.net/npm/iso-3166-1/iso-3166-1.min.js"></script> -->
</head>
<body>
    <h1>Card Checker</h1>
    <label for="Card">Card Number:</label><br>
    <input
      type="text"
      inputmode="numeric"
      pattern="[0-9\s]{13,19}"
      autocomplete="cc-number"
      minlength="12"
      maxlength="23"
      placeholder="4012 8888 8888 180 1881"
      id="cardNumberRaw"
      name="Card"
      style="text-align: left;"
      size="23"
    />
    <button id="cardSubmit">Submit</button>
    <p style="opacity: 0; transition: all 0.3s ease; text-align: left;" id="cardInputIncorrect">Card Number only allows numbers and spaces!</p><br>
    <p id="cardValidation">No Card to validate</p>
    <p id="cardIndustry"></p>
    <p id="cardIssuer"></p>

    <script>
        let regex = /^[0-9]+$/;

        document.getElementById('cardNumberRaw').addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                document.getElementById('cardSubmit').click();
            }
        });

        function ValidLuhn(checkNumber = String) {
            resultNumber = "";
            addition = 0;
            let valid;
            for (let run = 0; run < checkNumber.length; run++) {
                if (run % 2 === 0) {
                    if ((parseInt(checkNumber[run]) * 2) > 9) {
                        resultNumber += (parseInt(checkNumber[run]) * 2) - 9;
                        addition += (parseInt(checkNumber[run]) * 2) - 9;
                    } else {
                        resultNumber += (parseInt(checkNumber[run]) * 2);
                        addition += parseInt(checkNumber[run]) * 2;
                    }
                } else {
                    resultNumber += checkNumber[run];
                    addition += parseInt(checkNumber[run]);
                }
            }
            if (addition % 10 === 0) {
                valid = true;
            } else {
                valid = false;
            }
            console.log(addition)
            return valid;
        }

        function CheckCardIndustry(cardNumber) {
            let industry = "invalid";
            switch (cardNumber.substring(0, 1)) {
                case "0":
                    industry = "other";
                    break;
                case "1":
                    industry = "airlines"
                    break;
                case "2":
                    industry = "airlines, financial & others"
                    break;
                case "3":
                    industry = "travel & entertainment"
                    break;
                case "4":
                case "5":
                    industry = "banking & financial"
                    break;
                case "6":
                    industry = "merchandising & banking/financial"
                    break;
                case "7":
                    industry = "petroleum & others"
                    break;
                case "8":
                    if (cardNumber.length == 1) {
                        industry = "healthcare, telecommunications & others"
                    } else {
                        if (cardNumber.substring(1, 2) == "0") {
                            industry = "healthcare institution"
                        } else {
                            industry = "healthcare, telecommunications & others"
                        }
                    }
                    break;
                case "9":
                    industry = "goverment"
                    break;
            }
            return industry;
        }

        function CheckCardIssuer(cardNumber) {
            issuer = "unknown";
            if ([12, 14, 17, 18].includes(cardNumber.length)) {
                if (cardNumber.substring(0, 1) == "5") {
                    switch(cardNumber.substring(0, 4)) {
                        case "5018":
                        case "5020":
                        case "5038":
                        case "5893":
                            issuer = "Maestro"
                            break;
                    }
                }
                if (cardNumber.substring(0, 1) == "6") {
                    switch(cardNumber.substring(0, 4)) {
                        case "6304":
                        case "6761":
                        case "6762":
                        case "6763":
                            issuer = "Maestro"
                            break;
                        case "6759":
                            issuer = "Maestro or Maestro UK"
                            break;
                        case "6767":
                            if (["676770", "676774"].includes(cardNumber.substring(0, 6))) {
                                issuer = "Maestro UK"
                            }
                            break;
                    }
                }
            }
            if (cardNumber.length == 13) {
                if (cardNumber.substring(0, 1) == "4") {
                    issuer = "Visa"
                }
                if (cardNumber.substring(0, 1) == "5") {
                    switch(cardNumber.substring(0, 4)) {
                        case "5018":
                        case "5020":
                        case "5038":
                        case "5893":
                            issuer = "Maestro"
                            break;
                    }
                }
                if (cardNumber.substring(0, 1) == "6") {
                    switch(cardNumber.substring(0, 4)) {
                        case "6304":
                        case "6761":
                        case "6762":
                        case "6763":
                            issuer = "Maestro"
                            break;
                        case "6759":
                            issuer = "Maestro or Maestro UK"
                            break;
                        case "6767":
                            if (["676770", "676774"].includes(cardNumber.substring(0, 6))) {
                                issuer = "Maestro UK"
                            }
                            break;
                    }
                }
            }
            if (cardNumber.length == 15) {
                if (cardNumber.substring(0, 1) == "3") {
                    if (["34", "37"].includes(cardNumber.substring(0, 2))) {
                        issuer = "American Express"
                    }
                }
                if (cardNumber.substring(0, 1) == "5") {
                    switch(cardNumber.substring(0, 4)) {
                        case "5018":
                        case "5020":
                        case "5038":
                        case "5893":
                            issuer = "Maestro"
                            break;
                    }
                }
                if (cardNumber.substring(0, 1) == "6") {
                    switch(cardNumber.substring(0, 4)) {
                        case "6304":
                        case "6761":
                        case "6762":
                        case "6763":
                            issuer = "Maestro"
                            break;
                        case "6759":
                            issuer = "Maestro or Maestro UK"
                            break;
                        case "6767":
                            if (["676770", "676774"].includes(cardNumber.substring(0, 6))) {
                                issuer = "Maestro UK"
                            }
                            break;
                    }
                }
            }
            if (cardNumber.length == 16) {
                if (cardNumber.substring(0, 1) == "2") {
                    if (parseInt(cardNumber.substring(0, 4)) >= 2221 && parseInt(cardNumber.substring(0, 4)) <= 2720) {
                        issuer = "Mastercard"
                    }
                }
                if (cardNumber.substring(0, 1) == "4") {
                    if (["4026", "4508", "4844", "4913", "4917"].includes(cardNumber.substring(0, 4))) {
                        issuer = "Visa or Visa Electron"
                    } else if (cardNumber.substring(0, 6) == "417500") {
                        issuer = "Visa or Visa Electron"
                    } else {
                        issuer = "Visa"
                    }
                }
                if (cardNumber.substring(0, 1) == "5") {
                    switch(cardNumber.substring(0, 4)) {
                        case "5018":
                        case "5020":
                        case "5038":
                        case "5893":
                            issuer = "Maestro"
                            break;
                    }
                    if (parseInt(cardNumber.substring(0, 2)) >= 51 && parseInt(cardNumber.substring(0, 2)) <= 55) {
                        issuer = "Mastercard"
                    }
                }
                if (cardNumber.substring(0, 1) == "6") {
                    switch(cardNumber.substring(0, 4)) {
                        case "6304":
                        case "6761":
                        case "6762":
                        case "6763":
                            issuer = "Maestro"
                            break;
                        case "6759":
                            issuer = "Maestro or Maestro UK"
                            break;
                        case "6767":
                            if (["676770", "676774"].includes(cardNumber.substring(0, 6))) {
                                issuer = "Maestro UK"
                            }
                            break;
                    }
                }
            }
            if (cardNumber.length == 19) {
                if (cardNumber.substring(0, 1) == "4") {
                    issuer = "Visa"
                }
                if (cardNumber.substring(0, 1) == "5") {
                    switch(cardNumber.substring(0, 4)) {
                        case "5018":
                        case "5020":
                        case "5038":
                        case "5893":
                            issuer = "Maestro"
                            break;
                    }
                }
                if (cardNumber.substring(0, 1) == "6") {
                    switch(cardNumber.substring(0, 4)) {
                        case "6304":
                        case "6761":
                        case "6762":
                        case "6763":
                            issuer = "Maestro"
                            break;
                        case "6759":
                            issuer = "Maestro or Maestro UK"
                            break;
                        case "6767":
                            if (["676770", "676774"].includes(cardNumber.substring(0, 6))) {
                                issuer = "Maestro UK"
                            }
                            break;
                    }
                }
            }
            return issuer;
        }

        function SubmitCard() {
            let cardValidation = document.getElementById('cardValidation');
            let cardInputIncorrect = document.getElementById('cardInputIncorrect');
            let cardIndustry = document.getElementById('cardIndustry');
            let cardIssuer = document.getElementById('cardIssuer');
            let cardNumberRaw = document.getElementById('cardNumberRaw');
            let cardNumber = cardNumberRaw.value.replace(/\s+/g, '');
            if (cardNumber == "") {
                if (cardInputIncorrect.style.opacity != 0) {
                    cardInputIncorrect.style.opacity = 0;
                    setTimeout(function() {
                        cardInputIncorrect.innerText = "No number given!";
                        cardInputIncorrect.style.opacity = 1;
                    }, 300);
                } else {
                    cardInputIncorrect.innerText = "No number given!";
                    cardInputIncorrect.style.opacity = 1;
                }
            } else if (!regex.test(cardNumber)) {
                if (cardInputIncorrect.style.opacity != 0) {
                    cardInputIncorrect.style.opacity = 0;
                    setTimeout(function() {
                        cardInputIncorrect.innerText = "Card Number only allows numbers and spaces!";
                        cardInputIncorrect.style.opacity = 1;
                    }, 300);
                } else {
                    cardInputIncorrect.innerText = "Card Number only allows numbers and spaces!";
                    cardInputIncorrect.style.opacity = 1;
                }
            } else {
                cardInputIncorrect.style.opacity = 0;
                if (ValidLuhn(cardNumber)) {
                    cardValidation.innerText = "Card Valid!";
                } else {
                    cardValidation.innerText = "Card Invalid!";
                }
                cardIndustry.innerText = "Industry : " + CheckCardIndustry(cardNumber);
                cardIssuer.innerText = "Issuer     : " + CheckCardIssuer(cardNumber);
            }
        }

        document.getElementById('cardSubmit').addEventListener('click', SubmitCard);
    </script>
    <!-- <script type="module">
        import * as iso3166 from "https://cdn.jsdelivr.net/npm/iso-3166-1@2.1.1/dist/index.js";
        
        // Get country information by alpha-2 code
        const countryAlpha2 = iso3166.whereAlpha2('US');
        console.log(countryAlpha2); // { country: 'United States of America', alpha2: 'US', alpha3: 'USA', numeric: '840' }
        
        // Get country information by alpha-3 code
        const countryAlpha3 = iso3166.whereAlpha3('USA');
        console.log(countryAlpha3); // { country: 'United States of America', alpha2: 'US', alpha3: 'USA', numeric: '840' }
        
        // Get country information by numeric code
        const countryNumeric = iso3166.whereNumeric('840');
        console.log(countryNumeric); // { country: 'United States of America', alpha2: 'US', alpha3: 'USA', numeric: '840' }
        
        // Iterate through all countries
        const countries = iso3166.all();
        countries.forEach(country => {
            console.log(`${country.country} (${country.alpha2}, ${country.alpha3}, ${country.numeric})`);
        });
    </script> -->
</body>
</html>
